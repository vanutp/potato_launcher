services:
  backend:
    image: potato-launcher-backend
    container_name: potato-launcher-backend
    build:
      context: .
      dockerfile: backend/Dockerfile
    user: "${PUID:-1000}:${PGID:-1000}"
    environment:
      ADMIN_JWT_SECRET: ${ADMIN_JWT_SECRET}
      ADMIN_SECRET_TOKEN: ${ADMIN_SECRET_TOKEN}
      DOWNLOAD_SERVER_BASE: ${DOWNLOAD_SERVER_BASE}
      REPLACE_DOWNLOAD_URLS: ${REPLACE_DOWNLOAD_URLS:-false}
      LAUNCHER_NAME: ${LAUNCHER_NAME:-Potato Launcher}
    volumes:
      - ./state/internal:/data/internal
      - ./state/generated:/data/generated
      - ./state/workdir:/data/workdir
      - ./state/launcher:/data/launcher

  filebrowser:
    image: filebrowser/filebrowser:latest
    container_name: potato-launcher-filebrowser
    user: "${PUID:-1000}:${PGID:-1000}"
    command:
      - --noauth
      - --database=/database/filebrowser.db
      - --root=/srv
      - --port=80
      - --baseurl=/filebrowser
    volumes:
      - ./state/internal:/srv
      - ./state/filebrowser-db:/database

  nginx:
    image: potato-launcher-frontend
    container_name: potato-launcher-nginx
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_BASE_URL: ${VITE_API_BASE_URL}
        VITE_LAUNCHER_NAME: ${LAUNCHER_NAME:-Potato Launcher}
        VITE_GITHUB_URL: ${VITE_GITHUB_URL}
    depends_on:
      - backend
      - filebrowser
    ports:
      - "8000:80"
    volumes:
      - ./state/generated:/var/www/generated:ro
      - ./state/launcher:/var/www/launcher:ro
